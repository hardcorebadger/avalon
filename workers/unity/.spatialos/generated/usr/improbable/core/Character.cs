// Generated by SpatialOS codegen. DO NOT EDIT!
// source: Character in improbable/core/Character.schema.

namespace Improbable.Core
{

public static class Character_Extensions
{
  public static Character.Data Get(this global::Improbable.Worker.IComponentData<Character> data)
  {
    return (Character.Data) data;
  }

  public static Character.Update Get(this global::Improbable.Worker.IComponentUpdate<Character> update)
  {
    return (Character.Update) update;
  }

  public static Character.Commands.Goto.Request Get(this global::Improbable.Worker.ICommandRequest<Character.Commands.Goto> request)
  {
    return (Character.Commands.Goto.Request) request;
  }

  public static Character.Commands.Goto.Response Get(this global::Improbable.Worker.ICommandResponse<Character.Commands.Goto> response)
  {
    return (Character.Commands.Goto.Response) response;
  }
}

public partial class Character : global::Improbable.Worker.IComponentMetaclass
{
  public const uint ComponentId = 1002;

  uint global::Improbable.Worker.IComponentMetaclass.ComponentId
  {
    get { return ComponentId; }
  }

  /// <summary>
  /// Concrete data type for the Character component.
  /// </summary>
  public class Data : global::Improbable.Worker.IComponentData<Character>
  {
    public global::Improbable.Core.CharacterData Value;

    public Data(global::Improbable.Core.CharacterData value)
    {
      Value = value;
    }

    public Data(int playerId)
    {
      Value = new global::Improbable.Core.CharacterData(playerId);
    }

    public Data DeepCopy()
    {
      return new Data(Value.DeepCopy());
    }

    public global::Improbable.Worker.IComponentUpdate<Character> ToUpdate()
    {
      var update = new Update();
      update.SetPlayerId(Value.playerId);
      return update;
    }
  }

  /// <summary>
  /// Concrete update type for the Character component.
  /// </summary>
  public class Update : global::Improbable.Worker.IComponentUpdate<Character>
  {
    /// <summary>
    /// Field player_id = 1.
    /// </summary>
    public global::Improbable.Collections.Option<int> playerId;
    public Update SetPlayerId(int _value)
    {
      playerId.Set(_value);
      return this;
    }

    public Update DeepCopy()
    {
      var _result = new Update();
      if (playerId.HasValue)
      {
        int field;
        field = playerId.Value;
        _result.playerId.Set(field);
      }
      return _result;
    }

    public global::Improbable.Worker.IComponentData<Character> ToInitialData()
    {
      return new Data(new global::Improbable.Core.CharacterData(playerId.Value));
    }

    public void ApplyTo(global::Improbable.Worker.IComponentData<Character> _data)
    {
      var _concrete = _data.Get();
      if (playerId.HasValue)
      {
        _concrete.Value.playerId = playerId.Value;
      }
    }
  }

  public partial class Commands
  {
    /// <summary>
    /// Command goto.
    /// </summary>
    public partial class Goto : global::Improbable.Worker.ICommandMetaclass
    {
      public uint ComponentId { get { return 1002; } }
      public uint CommandId { get { return 1; } }

      public class Request : global::Improbable.Worker.ICommandRequest<Goto>
      {
        public global::Improbable.Core.GotoRequest Value;

        public Request(global::Improbable.Core.GotoRequest value)
        {
          Value = value;
        }

        public Request(global::Improbable.Vector3d targetPosition)
        {
          Value = new global::Improbable.Core.GotoRequest(targetPosition);
        }

        public Request DeepCopy()
        {
          return new Request(Value.DeepCopy());
        }

        public global::Improbable.Worker.Internal.GenericCommandObject ToGenericObject()
        {
          return new global::Improbable.Worker.Internal.GenericCommandObject(1, this);
        }
      }

      public class Response : global::Improbable.Worker.ICommandResponse<Goto>
      {
        public global::Improbable.Core.Nothing Value;

        public Response(global::Improbable.Core.Nothing value)
        {
          Value = value;
        }

        public Response()
        {
          Value = new global::Improbable.Core.Nothing();
        }

        public Response DeepCopy()
        {
          return new Response(Value.DeepCopy());
        }

        public global::Improbable.Worker.Internal.GenericCommandObject ToGenericObject()
        {
          return new global::Improbable.Worker.Internal.GenericCommandObject(1, this);
        }
      }
    }
  }

  // Implementation details below here.
  //----------------------------------------------------------------

  public global::Improbable.Worker.Internal.ComponentProtocol.ClientComponentVtable Vtable {
    get {
      global::Improbable.Worker.Internal.ComponentProtocol.ClientComponentVtable vtable;
      vtable.ComponentId = ComponentId;
      vtable.BufferFree = global::System.Runtime.InteropServices.Marshal
          .GetFunctionPointerForDelegate(global::Improbable.Worker.Internal.ClientObjects.ClientBufferFree);
      vtable.Free = global::System.Runtime.InteropServices.Marshal
          .GetFunctionPointerForDelegate(global::Improbable.Worker.Internal.ClientObjects.ClientFree);
      vtable.Copy = global::System.Runtime.InteropServices.Marshal
          .GetFunctionPointerForDelegate(global::Improbable.Worker.Internal.ClientObjects.ClientCopy);
      vtable.Deserialize = global::System.Runtime.InteropServices.Marshal
          .GetFunctionPointerForDelegate(clientDeserialize);
      vtable.Serialize = global::System.Runtime.InteropServices.Marshal
          .GetFunctionPointerForDelegate(clientSerialize);
      return vtable;
    }
  }

  public void AddSnapshotToEntity(global::Improbable.Worker.Internal.ComponentProtocol.ClientObject update,
                                  global::Improbable.Worker.Entity entity)
  {
    var dereferenced = (global::Improbable.Worker.IComponentData<Character>)
        global::Improbable.Worker.Internal.ClientObjects.Instance
        .Dereference(update.Reference);
    entity.Add<Character>(dereferenced);
  }

  public object ExtractSnapshot(global::Improbable.Worker.Entity entity)
  {
    return entity.Get<Character>().Value;
  }

  public void TrackComponent(global::Improbable.Worker.View view)
  {
    view.OnAddComponent<Character>(op =>
    {
      if (view.Entities.ContainsKey(op.EntityId))
      {
        view.Entities[op.EntityId].Add<Character>(op.Data);
      }
    });
    view.OnRemoveComponent<Character>(op =>
    {
      if (view.Entities.ContainsKey(op.EntityId))
      {
        view.Entities[op.EntityId].Remove<Character>();
      }
    });
    view.OnAuthorityChange<Character>(op =>
    {
      if (view.Entities.ContainsKey(op.EntityId))
      {
        view.Entities[op.EntityId].SetAuthority<Character>(op.HasAuthority);
      }
    });
    view.OnComponentUpdate<Character>(op =>
    {
      if (view.Entities.ContainsKey(op.EntityId))
      {
        view.Entities[op.EntityId].Update<Character>(op.Update);
      }
    });
  }

  private static unsafe readonly global::Improbable.Worker.Internal.ComponentProtocol.ClientDeserialize
      clientDeserialize = ClientDeserialize;
  private static unsafe readonly global::Improbable.Worker.Internal.ComponentProtocol.ClientSerialize
      clientSerialize = ClientSerialize;

  [global::Improbable.Worker.Internal.MonoPInvokeCallback(typeof(global::Improbable.Worker.Internal.ComponentProtocol.ClientDeserialize))]
  private static unsafe bool
  ClientDeserialize(global::System.UInt32 componentId,
                    global::System.Byte objType,
                    global::System.Byte* buffer,
                    global::System.UInt32 length,
                    global::Improbable.Worker.Internal.ComponentProtocol.ClientObject** obj)
  {
    *obj = null;
    using (var pbio = global::Improbable.Worker.Internal.Pbio.Create())
    {
      try
      {
        var root = global::Improbable.Worker.Internal.Pbio.GetRootObject(pbio);
        global::Improbable.Worker.Internal.Pbio.MergeFromBuffer(root, buffer, length);
        *obj = global::Improbable.Worker.Internal.ClientObjects.ObjectAlloc();
        if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Update) {
          var data = new Update();
          var fieldsToClear = new global::System.Collections.Generic.HashSet<uint>();
          var fieldsToClearCount = global::Improbable.Worker.Internal.Pbio.GetUint32Count(root, /* fields to clear */ 1);
          for (uint i = 0; i < fieldsToClearCount; ++i)
          {
             fieldsToClear.Add(global::Improbable.Worker.Internal.Pbio.IndexUint32(root, /* fields to clear */ 1, i));
          }
          var stateObject = global::Improbable.Worker.Internal.Pbio.GetObject(
              global::Improbable.Worker.Internal.Pbio.GetObject(root, /* entity_state */ 2), 1002);
          if (global::Improbable.Worker.Internal.Pbio.GetInt32Count(stateObject, 1) > 0)
          {
            int field;
            {
              field = global::Improbable.Worker.Internal.Pbio.GetInt32(stateObject, 1);
            }
            data.playerId.Set(field);
          }
          (*obj)->Reference = global::Improbable.Worker.Internal.ClientObjects.Instance.CreateReference(data);
        }
        else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Snapshot)
        {
          var data = new Data(global::Improbable.Core.CharacterData_Internal.Read(
              global::Improbable.Worker.Internal.Pbio.GetObject(root, 1002)));
          (*obj)->Reference = global::Improbable.Worker.Internal.ClientObjects.Instance.CreateReference(data);
        }
        else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Request)
        {
          var data = new global::Improbable.Worker.Internal.GenericCommandObject();
          var commandObject = global::Improbable.Worker.Internal.Pbio.GetObject(root, 1002);
          if (global::Improbable.Worker.Internal.Pbio.GetObjectCount(commandObject, 1) != 0) {
            data.CommandId = 1;
            data.CommandObject = new Commands.Goto.Request(global::Improbable.Core.GotoRequest_Internal.Read(global::Improbable.Worker.Internal.Pbio.GetObject(commandObject, 1)));
          }
          (*obj)->Reference = global::Improbable.Worker.Internal.ClientObjects.Instance.CreateReference(data);
        }
        else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Response)
        {
          var data = new global::Improbable.Worker.Internal.GenericCommandObject();
          var commandObject = global::Improbable.Worker.Internal.Pbio.GetObject(root, 1002);
          if (global::Improbable.Worker.Internal.Pbio.GetObjectCount(commandObject, 2) != 0) {
            data.CommandId = 1;
            data.CommandObject = new Commands.Goto.Response(global::Improbable.Core.Nothing_Internal.Read(global::Improbable.Worker.Internal.Pbio.GetObject(commandObject, 2)));
          }
          (*obj)->Reference = global::Improbable.Worker.Internal.ClientObjects.Instance.CreateReference(data);
        }
      }
      catch (global::System.Exception e)
      {
        global::Improbable.Worker.ClientError.LogClientException(e);
        return false;
      }
      return true;
    }
  }

  [global::Improbable.Worker.Internal.MonoPInvokeCallback(typeof(global::Improbable.Worker.Internal.ComponentProtocol.ClientSerialize))]
  private static unsafe void
  ClientSerialize(global::System.UInt32 componentId,
                  global::System.Byte objType,
                  global::Improbable.Worker.Internal.ComponentProtocol.ClientObject* obj,
                  global::System.Byte** buffer,
                  global::System.UInt32* length)
  {
    *buffer = null;
    *length = 0;
    using (var _pool = new global::Improbable.Worker.Internal.PbioHandlePool())
    {
      try
      {
        var root = global::Improbable.Worker.Internal.Pbio.GetRootObject(_pool.GetPbio());
        if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Update) {
          var data = (Update) global::Improbable.Worker.Internal.ClientObjects.Instance.Dereference(obj->Reference);
          var stateObject = global::Improbable.Worker.Internal.Pbio.AddObject(
              global::Improbable.Worker.Internal.Pbio.AddObject(root, /* entity_state */ 2), 1002);
          if (data.playerId.HasValue)
          {
            {
              global::Improbable.Worker.Internal.Pbio.AddInt32(stateObject, 1, data.playerId.Value);
            }
          }
        }
        else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Snapshot) {
          var data = (Data) global::Improbable.Worker.Internal.ClientObjects.Instance.Dereference(obj->Reference);
          global::Improbable.Core.CharacterData_Internal.Write(_pool, data.Value, global::Improbable.Worker.Internal.Pbio.AddObject(root, 1002));
        }
        else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Request)
        {
          var data = (global::Improbable.Worker.Internal.GenericCommandObject)
              global::Improbable.Worker.Internal.ClientObjects.Instance.Dereference(obj->Reference);
          var commandObject = global::Improbable.Worker.Internal.Pbio.AddObject(root, 1002);
          if (data.CommandId == 1)
          {
            var requestObject = (Commands.Goto.Request) data.CommandObject;
            {
              global::Improbable.Core.GotoRequest_Internal.Write(_pool, requestObject.Value, global::Improbable.Worker.Internal.Pbio.AddObject(commandObject, 1));
            }
          }
        }
        else if (objType == (byte) global::Improbable.Worker.Internal.ComponentProtocol.ClientObjectType.Response)
        {
          var data = (global::Improbable.Worker.Internal.GenericCommandObject)
              global::Improbable.Worker.Internal.ClientObjects.Instance.Dereference(obj->Reference);
          var commandObject = global::Improbable.Worker.Internal.Pbio.AddObject(root, 1002);
          if (data.CommandId == 1)
          {
            var responseObject = (Commands.Goto.Response) data.CommandObject;
            {
              global::Improbable.Core.Nothing_Internal.Write(_pool, responseObject.Value, global::Improbable.Worker.Internal.Pbio.AddObject(commandObject, 2));
            }
          }
        }
        *length = global::Improbable.Worker.Internal.Pbio.GetWriteBufferLength(root);
        *buffer = global::Improbable.Worker.Internal.ClientObjects.BufferAlloc((int) *length);
        global::Improbable.Worker.Internal.Pbio.WriteToBuffer(root, *buffer);
      }
      catch (global::System.Exception e)
      {
        global::Improbable.Worker.ClientError.LogClientException(e);
      }
    }
  }
}

}
